<!doctype html>
<html><head><meta charset="utf-8"/><title>Admin</title></head><body>
  <h1>Admin Dashboard</h1>
  <ul>
    <li><a href="/admin/new-requests">New Requests</a></li>
    <li>
      Attendance by date: <input type="date" id="datePicker" value="<%= new Date().toISOString().slice(0,10) %>">
      <button id="load">Load</button>
      <div id="list"></div>
    </li>
    <li>
      Reports: Generate CSV for date <input type="date" id="rdate" value="<%= new Date().toISOString().slice(0,10) %>">
      <button id="gen">Download CSV</button>
    </li>
  </ul>
  <p><a href="/logout">Logout</a></p>

  <script>
    document.getElementById('load').addEventListener('click', async ()=>{
      const date = document.getElementById('datePicker').value;
      const res = await fetch('/admin/attendance-by-date?date=' + date);
      const j = await res.json();
      const container = document.getElementById('list');
      container.innerHTML = '<h3>Attendance for ' + j.date + '</h3>';
      const ul = document.createElement('ul');
      j.list.forEach(s => {
        const li = document.createElement('li');
        li.innerText = s.name + ' â€” ' + s.status + (s.lastToggledAt ? ' (at '+ new Date(s.lastToggledAt).toLocaleTimeString()+')' : '');
        ul.appendChild(li);
      });
      container.appendChild(ul);
    });

    document.getElementById('gen').addEventListener('click', ()=>{
      const d = document.getElementById('rdate').value;
      window.location = '/admin/report?date=' + d;
    });
  </script>
</body></html>
